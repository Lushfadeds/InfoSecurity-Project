{% extends "base.html" %}

{% block title %}Login - PinkHealth{% endblock %}
{% block navbar %}{% endblock %}

{% block content %}
<div class="bg-gradient-to-br from-pink-50 to-white min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-md">
    <!-- Logo -->
    <a href="{{ url_for('index') }}" class="flex items-center justify-center gap-2 mb-8">
      <div class="w-12 h-12 bg-gradient-to-br from-pink-400 to-pink-500 rounded-lg flex items-center justify-center">
        <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
        </svg>
      </div>
      <span class="text-pink-600 text-2xl font-bold">PinkHealth</span>
    </a>

    <!-- Login Card -->
    <div class="bg-white rounded-xl shadow-lg border border-gray-200 p-8">
      <h1 class="text-2xl font-bold text-gray-900 text-center mb-6" id="formTitle">
        Welcome Back
      </h1>

        <form method="POST" id="loginForm" class="space-y-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <!-- Step 1: Credentials -->
            <div id="step1" class="space-y-4">
              <div>
                <label class="block text-gray-700 font-medium mb-2">Email</label>
                <input type="email" name="email" id="email" placeholder="your@email.com" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" required>
              </div>
              <div>
                <label class="block text-gray-700 font-medium mb-2">Password</label>
                <input type="password" name="password" id="password" placeholder="••••••••" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500" required>
              </div>
              <div class="flex items-center">
                <input type="checkbox" id="remember" class="w-4 h-4 text-pink-600 rounded">
                <label for="remember" class="ml-2 text-sm text-gray-600">Remember me</label>
              </div>
            </div>

            <!-- Step 2: MFA -->

            <!-- Exclude MFA For Now
            <div id="step2" class="space-y-4 hidden">
              <p class="text-gray-600 text-sm">A verification code has been sent to your registered email.</p>
              <div>
                <label class="block text-gray-700 font-medium mb-2">Verification Code</label>
                <input type="text" id="totpCode" placeholder="000000" maxlength="6" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 text-center text-2xl letter-spacing" required>
              </div>
            </div>
            -->

            <!-- Error Message -->
            <div>
                {% with messages = get_flashed_messages(category_filter=["error"]) %}
                    {% if messages %}
                        {% for message in messages %}
                            <p class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4">{{ message }}</p>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>

            <!-- Submit Button -->
            <button type="submit" class="w-full py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition font-medium">
              <span id="submitText">Continue</span>
            </button>
        </form>

        <!-- Forgot Password Link -->
        <div class="text-center">
          <a href="{{ url_for('reset_password') }}" class="text-pink-600 hover:text-pink-700 text-sm">
            Forgot your password?
          </a>
        </div>

        <!-- Sign Up Link -->
        <div class="text-center text-sm text-gray-600">
          Don't have an account?
          <a href="{{ url_for('signup') }}" class="text-pink-600 hover:text-pink-700 font-medium">
            Register as Patient
          </a>
        </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
    <script>
        let selectedRole = '';
        let currentStep = 1;
        
        // Role selection
        document.querySelectorAll('.role-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            selectedRole = this.getAttribute('data-role');
            document.querySelectorAll('.role-btn').forEach(b => {
              b.classList.remove('border-pink-500', 'bg-pink-50', 'border-blue-500', 'bg-blue-50', 'border-purple-500', 'bg-purple-50', 'border-red-500', 'bg-red-50');
              b.classList.add('border-gray-200');
            });
            const colors = {
              patient: ['border-pink-500', 'bg-pink-50'],
              doctor: ['border-blue-500', 'bg-blue-50'],
              staff: ['border-purple-500', 'bg-purple-50'],
              admin: ['border-red-500', 'bg-red-50']
            };
            this.classList.remove('border-gray-200');
            this.classList.add(...colors[selectedRole]);
          });
        });
    </script>
{% endblock %}