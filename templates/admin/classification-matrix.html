{% extends "base.html" %}

{% block title %}Classification Summary Matrix - PinkHealth{% endblock %}

{% block content %}
<div class="bg-gray-50">
  <div class="flex">
    {% set active_page = 'classification_matrix' %}
    <!-- Sidebar -->
    {% include 'includes/admin-navbar.html' %}

    <main class="flex-1 p-8">
      <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Classification Summary Matrix</h1>
        <p class="text-gray-600">Overview of all classified records across the system by sensitivity level</p>
      </div>

      <!-- Main Matrix Table -->
      <div class="bg-white rounded-xl border border-gray-200 p-8 mb-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Record Distribution by Classification Level</h2>
        
        <!-- Horizontal Classification Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <!-- Restricted -->
          <div class="border-2 border-red-600 rounded-lg p-6 bg-red-50">
            <p class="text-lg font-bold text-red-900 mb-3">Restricted</p>
            <p class="text-4xl font-bold text-red-600 mb-2">{{ classification_counts.restricted }}</p>
            <p class="text-sm text-red-700">records</p>
          </div>

          <!-- Confidential -->
          <div class="border-2 border-yellow-600 rounded-lg p-6 bg-yellow-50">
            <p class="text-lg font-bold text-yellow-900 mb-3">Confidential</p>
            <p class="text-4xl font-bold text-yellow-600 mb-2">{{ classification_counts.confidential }}</p>
            <p class="text-sm text-yellow-700">records</p>
          </div>

          <!-- Internal -->
          <div class="border-2 border-blue-600 rounded-lg p-6 bg-blue-50">
            <p class="text-lg font-bold text-blue-900 mb-3">Internal</p>
            <p class="text-4xl font-bold text-blue-600 mb-2">{{ classification_counts.internal }}</p>
            <p class="text-sm text-blue-700">records</p>
          </div>

          <!-- Public -->
          <div class="border-2 border-green-600 rounded-lg p-6 bg-green-50">
            <p class="text-lg font-bold text-green-900 mb-3">Public</p>
            <p class="text-4xl font-bold text-green-600 mb-2">{{ classification_counts.public }}</p>
            <p class="text-sm text-green-700">records</p>
          </div>
        </div>

        <!-- Total Row -->
        <div class="mt-8 pt-8 border-t-2 border-gray-300">
          <p class="text-lg font-semibold text-gray-900 mb-4">Total Records</p>
          <p class="text-5xl font-bold text-gray-900">{{ classification_counts.total }}</p>
        </div>
      </div>

      <!-- Records Overview Details -->
      <div class="bg-white rounded-xl border border-gray-200 p-8 mb-8">
        <h2 class="text-2xl font-bold text-gray-900 mb-6">Records Overview Details</h2>

        <div class="flex flex-col gap-3 md:flex-row md:items-center md:gap-4 mb-6">
          <div class="w-full md:w-56">
            <label for="matrix-search-field" class="block text-sm font-semibold text-gray-700 mb-1">Search Field</label>
            <select id="matrix-search-field" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-700 bg-white">
              <option value="id">Record ID</option>
              <option value="type">Type</option>
              <option value="classification">Classification</option>
              <option value="method">Method</option>
              <option value="creation_time">Creation Time</option>
              <option value="uploaded_by">Uploaded By</option>
              <option value="role">Role</option>
            </select>
          </div>
          <div class="flex-1">
            <label for="matrix-search-input" class="block text-sm font-semibold text-gray-700 mb-1">Search</label>
            <input id="matrix-search-input" type="text" placeholder="Type to filter records..." class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm text-gray-700" />
          </div>
        </div>
        
        <!-- Records Table -->
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-100 border-b-2 border-gray-300">
              <tr>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Record ID</th>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Type</th>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Classification</th>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Method</th>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Creation Time</th>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Uploaded By</th>
                <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900">Role</th>
              </tr>
            </thead>
            <tbody id="matrix-records" class="divide-y divide-gray-200">
              {% for record in records %}
              <tr class="hover:bg-gray-50 matrix-record"
                  data-id="{{ record.id }}"
                  data-type="{{ record.type }}"
                  data-classification="{{ record.classification }}"
                  data-method="{{ record.method }}"
                  data-creation_time="{{ record.creation_time }}"
                  data-uploaded_by="{{ record.uploaded_by }}"
                  data-role="{{ record.role }}">
                <td class="px-6 py-4 text-sm text-gray-900">{{ record.id }}</td>
                <td class="px-6 py-4 text-sm text-gray-600">{{ record.type }}</td>
                <td class="px-6 py-4 text-sm">
                  {% if record.classification == 'Restricted' %}
                    <span class="px-3 py-1 text-xs font-semibold text-red-900 bg-red-100 rounded-full">{{ record.classification }}</span>
                  {% elif record.classification == 'Confidential' %}
                    <span class="px-3 py-1 text-xs font-semibold text-yellow-900 bg-yellow-100 rounded-full">{{ record.classification }}</span>
                  {% elif record.classification == 'Internal' %}
                    <span class="px-3 py-1 text-xs font-semibold text-blue-900 bg-blue-100 rounded-full">{{ record.classification }}</span>
                  {% elif record.classification == 'Public' %}
                    <span class="px-3 py-1 text-xs font-semibold text-green-900 bg-green-100 rounded-full">{{ record.classification }}</span>
                  {% endif %}
                </td>
                <td class="px-6 py-4 text-sm">
                  {% if record.method == 'Manual' %}
                    <span class="px-3 py-1 text-xs font-semibold rounded-full" style="background-color: #8E44AD; color: white;">{{ record.method }}</span>
                  {% elif record.method == 'Automatic' %}
                    <span class="px-3 py-1 text-xs font-semibold rounded-full" style="background-color: #1ABC9C; color: white;">{{ record.method }}</span>
                  {% else %}
                    <span class="px-3 py-1 text-xs font-semibold text-gray-900 bg-gray-100 rounded-full">{{ record.method }}</span>
                  {% endif %}
                </td>
                <td class="px-6 py-4 text-sm text-gray-600">{{ record.creation_time }}</td>
                <td class="px-6 py-4 text-sm text-gray-600">{{ record.uploaded_by }}</td>
                <td class="px-6 py-4 text-sm text-gray-600">{{ record.role }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Classification Guide -->
      <div class="grid lg:grid-cols-2 gap-6">
        <div class="bg-white rounded-xl border border-gray-200 p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Classification Levels</h3>
          <div class="space-y-4">
            <div class="border-l-2 border-red-600 pl-4">
              <p class="font-semibold text-gray-900">Restricted</p>
              <p class="text-sm text-gray-600">Highly sensitive medical data including clinical notes and diagnostic information. Access is limited to authorized medical staff (e.g., doctors) for patient care and must be protected to ensure confidentiality and regulatory compliance.</p>
            </div>
            <div class="border-l-2 border-yellow-600 pl-4">
              <p class="font-semibold text-gray-900">Confidential</p>
              <p class="text-sm text-gray-600">Sensitive patient information, including personal details and selected clinical notes. Access requires proper authorization and is typically used for medical certificates and related records, with care taken to protect patient privacy.</p>
            </div>
            <div class="border-l-2 border-blue-600 pl-4">
              <p class="font-semibold text-gray-900">Internal</p>
              <p class="text-sm text-gray-600">General operational data for daily clinic activities and internal coordination. Accessible to clinic staff and used for administrative purposes, such as staff memos, team notes, duty rosters, and internal announcements.</p>
            </div>
            <div class="border-l-2 border-green-600 pl-4">
              <p class="font-semibold text-gray-900">Public</p>
              <p class="text-sm text-gray-600">Non-sensitive information that can be shared externally. Includes general clinic announcements, policies, and job vacancy postings, and does not contain personal or confidential data.</p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl border border-gray-200 p-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Data Protection Notes</h3>
          <ul class="space-y-3 text-sm text-gray-700">
            <li class="flex items-start">
              <span class="text-green-600 font-bold mr-3">✓</span>
              <span>All restricted and confidential records are encrypted at rest</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-600 font-bold mr-3">✓</span>
              <span>Access to classified records is logged and audited</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-600 font-bold mr-3">✓</span>
              <span>Classification is automatically suggested based on data type</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-600 font-bold mr-3">✓</span>
              <span>Users can override auto-classification with proper justification</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-600 font-bold mr-3">✓</span>
              <span>NRIC and sensitive PHI are masked in all interfaces</span>
            </li>
            <li class="flex items-start">
              <span class="text-green-600 font-bold mr-3">✓</span>
              <span>Tampering with audit logs triggers security alerts</span>
            </li>
          </ul>
        </div>
      </div>
    </main>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://unpkg.com/lucide@latest"></script>
<script>
  lucide.createIcons();

  const searchField = document.getElementById("matrix-search-field");
  const searchInput = document.getElementById("matrix-search-input");
  const recordRows = Array.from(document.querySelectorAll(".matrix-record"));

  function filterMatrixRecords() {
    const field = searchField.value;
    const term = searchInput.value.trim().toLowerCase();

    recordRows.forEach((row) => {
      const value = (row.dataset[field] || "").toLowerCase();
      const isMatch = term === "" || value.includes(term);
      row.style.display = isMatch ? "" : "none";
    });
  }

  searchField.addEventListener("change", filterMatrixRecords);
  searchInput.addEventListener("input", filterMatrixRecords);
</script>
{% endblock %}
